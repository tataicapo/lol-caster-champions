<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PAGE settings -->
  <link rel="icon" href="https://templates.pingendo.com/assets/Pingendo_favicon.ico">
  <title>Checkout</title>
  <meta name="description" content="Wireframe design of a checkout form by Pingendo">
  <meta name="keywords" content="Pingendo bootstrap example template wireframe checkout form">
  <meta name="author" content="Pingendo">
  <!-- CSS dependencies -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.css">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.css">
</head>

<body class="bg-light">

  <!-- <% include partials/navegation.ejs %> -->


  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="text-center col-md-7 mx-auto"> <i class="fa d-block fa-bullseye fa-5x mb-4 text-info"></i>
          <h2>LOL CASTER CHAMPIONS</h2>
          <p class="lead">Aplicacion echa para casters de League of Legends, permite tener a mano los nombres de las
            halibilidad de los champions en partida.</p>
        </div>
      </div>
    </div>
    <div class="container"></div>
  </div>

  <div class="tab-content mt-2">
    <div class="tab-pane fade show active" id="tabone" role="tabpanel">
      <div class="col-md-12">
        <div class="table-responsive">
          <table class="table table-striped table-dark">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Invocador</th>
                <th scope="col">Campeon</th>
                <th scope="col">Q</th>
                <th scope="col">W</th>
                <th scope="col">E</th>
                <th scope="col">R</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">TOP</th>
                <td>
                  <p id="1_1"></p>
                </td>
                <td>
                  <p id="1_2"></p>
                </td>
                <td>
                  <p id="1_3"></p>
                </td>
                <td>
                  <p id="1_4"></p>
                </td>
                <td>
                  <p id="1_5"></p>
                </td>
                <td>
                  <p id="1_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">JG</th>
                <td>
                  <p id="2_1"></p>
                </td>
                <td>
                  <p id="2_2"></p>
                </td>
                <td>
                  <p id="2_3"></p>
                </td>
                <td>
                  <p id="2_4"></p>
                </td>
                <td>
                  <p id="2_5"></p>
                </td>
                <td>
                  <p id="2_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">MID</th>
                <td>
                  <p id="3_1"></p>
                </td>
                <td>
                  <p id="3_2"></p>
                </td>
                <td>
                  <p id="3_3"></p>
                </td>
                <td>
                  <p id="3_4"></p>
                </td>
                <td>
                  <p id="3_5"></p>
                </td>
                <td>
                  <p id="3_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">ADC</th>
                <td>
                  <p id="4_1"></p>
                </td>
                <td>
                  <p id="4_2"></p>
                </td>
                <td>
                  <p id="4_3"></p>
                </td>
                <td>
                  <p id="4_4"></p>
                </td>
                <td>
                  <p id="4_5"></p>
                </td>
                <td>
                  <p id="4_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">SUPP</th>
                <td>
                  <p id="5_1"></p>
                </td>
                <td>
                  <p id="5_2"></p>
                </td>
                <td>
                  <p id="5_3"></p>
                </td>
                <td>
                  <p id="5_4"></p>
                </td>
                <td>
                  <p id="5_5"></p>
                </td>
                <td>
                  <p id="5_6"></p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-md-12">
        <div class="table-responsive">
          <table class="table table-striped table-dark">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Invocador</th>
                <th scope="col">Campeon</th>
                <th scope="col">Q</th>
                <th scope="col">W</th>
                <th scope="col">E</th>
                <th scope="col">R</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">TOP</th>
                <td>
                  <p id="6_1"></p>
                </td>
                <td>
                  <p id="6_2"></p>
                </td>
                <td>
                  <p id="6_3"></p>
                </td>
                <td>
                  <p id="6_4"></p>
                </td>
                <td>
                  <p id="6_5"></p>
                </td>
                <td>
                  <p id="6_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">JG</th>
                <td>
                  <p id="7_1"></p>
                </td>
                <td>
                  <p id="7_2"></p>
                </td>
                <td>
                  <p id="7_3"></p>
                </td>
                <td>
                  <p id="7_4"></p>
                </td>
                <td>
                  <p id="7_5"></p>
                </td>
                <td>
                  <p id="7_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">MID</th>
                <td>
                  <p id="8_1"></p>
                </td>
                <td>
                  <p id="8_2"></p>
                </td>
                <td>
                  <p id="8_3"></p>
                </td>
                <td>
                  <p id="8_4"></p>
                </td>
                <td>
                  <p id="8_5"></p>
                </td>
                <td>
                  <p id="8_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">ADC</th>
                <td>
                  <p id="9_1"></p>
                </td>
                <td>
                  <p id="9_2"></p>
                </td>
                <td>
                  <p id="9_3"></p>
                </td>
                <td>
                  <p id="9_4"></p>
                </td>
                <td>
                  <p id="9_5"></p>
                </td>
                <td>
                  <p id="9_6"></p>
                </td>
              </tr>
              <tr>
                <th scope="row">SUPP</th>
                <td>
                  <p id="10_1"></p>
                </td>
                <td>
                  <p id="10_2"></p>
                </td>
                <td>
                  <p id="10_3"></p>
                </td>
                <td>
                  <p id="10_4"></p>
                </td>
                <td>
                  <p id="10_5"></p>
                </td>
                <td>
                  <p id="10_6"></p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="tabtwo" role="tabpanel">
      <div class="table-responsive">
        <table class="table table-striped table-dark">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Invocador</th>
              <th scope="col">Champion</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">1</th>
              <td>
              </td>
              <td></td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <th scope="row">3</th>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <th scope="row">4</th>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <th scope="row">5</th>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="tab-pane fade" id="tabthree" role="tabpanel">
      <p class=""></p>
    </div>
  </div>
  </div>
  <div class="">
    <div class="container">
      <div class="row">
        <div class="input-group input-group-default mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-default">Invocador</span>
          </div>
          <input type="text" class="form-control" id="invocador" aria-label="Sizing example input"
            aria-describedby="inputGroup-sizing-default">
            
          <div class="btn-group">
            <select id="options">
              <option value="BR1">BR</option>
              <option value="EUN1">EUNE</option>
              <option value="EUW1">EUW</option>
              <option value="JP1">JP</option>
              <option value="KR">KR</option>
              <option value="LA1">LAN</option>
              <option value="LA2" selected="selected">LAS</option>
              <option value="NA1">NA</option>
              <option value="OC">OCE</option>
              <option value="TR1">TR</option>
              <option value="RU">RU</option>
              <option value="PBE1">PBE</option>
            </select>
            <button type="button" class="btn btn-secondary" id="buscarInvocador">Buscar</button>
          </div>
        </div>

      </div>
      <div class="row"></div>
    </div>
  </div>
  <div class="py-5 text-muted text-center">
    <div class="container">
      <div class="row">
        <div class="col-md-12 my-4">
          <p class="mb-1">Â© 2019 - Noticiero eSports</p>
          <ul class="list-inline">
            <li class="list-inline-item">
              <a href="https://www.youtube.com/channel/UC2jNiuCkfXhVowEAIbzmCmg?guided_help_flow=3">Privacy</a>
            </li>
            <li class="list-inline-item">
              <a href="https://www.youtube.com/channel/UC2jNiuCkfXhVowEAIbzmCmg?guided_help_flow=3">Terms</a>
            </li>
            <li class="list-inline-item">
              <a href="https://www.youtube.com/channel/UC2jNiuCkfXhVowEAIbzmCmg?guided_help_flow=3">Support</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row"></div>
    </div>
  </div>
  <script src="http://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.js" type="text/javascript"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.js"></script>
  <script>

    // =============== START ==========================

    var respuesta
    var champRespuesta
    var campeones = ["", "", ""]

    $("#invocador").val(sessionStorage.getItem("invocador"))
    obtenerCampeones()

    $("#invocador").focus();

    // ================================================

    // ================================================


    document.querySelector("#invocador").addEventListener("keyup", event => {
    if(event.key !== "Enter") return // Use `.key` instead.
    document.querySelector("#buscarInvocador").click() // Things you want to do.
    event.preventDefault() // No need to `return false;`.
    })





    $("#buscarInvocador").click(function () {


      var e = document.getElementById("options");
      var servidor = e.options[e.selectedIndex].value;

      sessionStorage.setItem("invocador", $("#invocador").val())

      var url = 'http://localhost:3000/res?jugador=' + $("#invocador").val() + '&servidor=' + servidor

      var request = new XMLHttpRequest();
      request.onreadystatechange = function () {
        if (request.readyState == XMLHttpRequest.DONE) {
          respuesta = request.responseText
        }
      }
      request.open('GET', url, false);
      request.send(null);
      




      //====================================================

      var obj = JSON.parse(respuesta)
      //console.log(obj)

      if (obj.hasOwnProperty('status')) {

        if (obj.status.status_code == 404) {

          console.log('El jugador no esta en partida')

        } else if (obj.status.status_code == 400) {

          console.log('La APIkey de Riot esta caducada')

        }

      } else {

        // A_B
        // A linea
        // B columna
        for (A = 0; A < 10; A++) {

          $('#' + (A + 1) + '_1').text(obj.participants[A].summonerName)
          $('#' + (A + 1) + '_2').text(campeones[obj.participants[A].championId])


          //==================================================

          var champServer = new XMLHttpRequest();
          champServer.onreadystatechange = function () {
            if (champServer.readyState == XMLHttpRequest.DONE) {
              champRespuesta = champServer.responseText
            }
          }

          var champUrl = 'http://localhost:3000/champ?champ=' + campeones[obj.participants[A].championId]

          champServer.open('GET', champUrl, false)
          champServer.send(null);

          //console.log('respuesta: '+champRespuesta)

          //==================================================

          if (champRespuesta === 'error') {

            console.log('Campeon desconocido')

          } else {

            champArray = JSON.parse(champRespuesta)

            var champA = campeones[obj.participants[A].championId]

            $('#' + (A + 1) + '_3').text(champArray.data[champA].spells[0].name)
            $('#' + (A + 1) + '_4').text(champArray.data[champA].spells[1].name)
            $('#' + (A + 1) + '_5').text(champArray.data[champA].spells[2].name)
            $('#' + (A + 1) + '_6').text(champArray.data[champA].spells[3].name)

          }
        }
      }



      //====================================================


    })


    function obtenerCampeones() {

      $.getJSON('http://ddragon.leagueoflegends.com/cdn/6.24.1/data/en_US/champion.json', function (data) {

        var campeonesLista = Object.keys(data.data)

        for (i = 0; i < campeonesLista.length; i++) {

          var output = Object.keys(data.data)[i]

          var idCampeon = data.data[output].key

          campeones[idCampeon] = output

        }
      });
    }


  </script>
</body>

</html>